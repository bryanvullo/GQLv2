Graph graph = READFILE "network.n4j"

String regex = r"^[ABC].*"

Graph result

FOR (Node person : graph) {
    IF (person.firstName MATCHES regex) {
        FOR (Node friend : graph) {
            IF (person-[:IsFriend]->friend && 
                friend.age > person.age && 
                NOT EXISTS(friend-[:WorksFor]->(:Cafe))) {
                result.ADD(person)
                result.ADD(friend)
                result.ADD(person-[:IsFriend]->friend)
            }
        }
    }
}

PRINT(result)