# pr4.gql
DataGraph network = ACCESS("network.n4j")
DataGraph output

THROUGH (Node person : network) {
  CONDIF (person.HAS("firstName") AND 
          person.firstName >> "A" AND person.firstName << "D") {
    THROUGH (Node friend : network) {
      CONDIF (person{:TYPE i== "IsFriend"}^friend AND 
              person.age << friend.age AND
              friend.CALLASSOCIATION(:TYPE i== "WorksFor" AND :LABEL i== "Cafe") i== null) {
        output.PLUS(person)
        output.PLUS(friend)
        
        Association friendship 
        friendship.:TYPE = "IsFriend"
        friendship.:START_ID = person
        friendship.:END_ID = friend
        output.PLUS(friendship)
      }
    }
  }
}

STDOUT(output)