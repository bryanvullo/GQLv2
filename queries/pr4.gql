DataGraph graph = ACCESS("networks.n4j")
DataGraph initial = graph.CASE(firstname i== r"^(A|B|C)")
DataGraph second

THROUGH (Association isFriendRelation : initial.CALLASSOCIATION(:TYPE i== "IsFriend")) {
  CONDIF (((initial.CASE(:ID i== isFriendRelation.:START_ID).age) < (initial.CASE(:ID i== isFriendRelation.:END_ID).age))) {
    CONDIF (initial.CALLDATAPOINT(initial.CALLASSOCIATION(:TYPE i== "WorksFor").CASE(:START_ID i== isFriendRelation.:END_ID).:END_ID).:LABEL.CONTAINS("Cafe")) {
      second.PLUS(initial.CALLDATAPOINT(isFriendRelation.:START_ID))
      second.PLUS(isFriendRelation)
    }
  }
}

STDOUT(second)